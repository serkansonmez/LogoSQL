USE [TIGER2_DB]
GO

/****** Object:  View [dbo].[VW_106_20_PERFORMANS_TOPLAM_CRYSTAL]    Script Date: 8.12.2021 22:02:02 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




















--SELECT * FROM [VW_106_20_PERFORMANS_TOPLAM_CRYSTAL] WHERE MASRAFKODU LIKE '9%'



ALTER    VIEW [dbo].[VW_106_20_PERFORMANS_TOPLAM_CRYSTAL] AS

--1- HAKEDÝÞ FÝYAT FARKI NEGATÝF GELÝR OLARAK RAPORA ÝLAVE EDÝLDÝ 06.02.2019

SELECT --TOP 1000    	
	'GELÝRLER' AS TUR,
    dbo.LG_106_20_STFICHE.FICHENO AS FISNO, 
	--'-' AS FISNO,
	dbo.LG_106_20_STFICHE.DATE_ AS FISTARIHI,
	DatePart(yy, dbo.LG_106_20_STFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_STFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_STFICHE.DATE_)AS GUN, 
	dbo.LG_106_ITEMS.CODE AS MASRAFKODU, 
	dbo.LG_106_ITEMS.NAME AS MASRAFADI,

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN VATMATRAH * -1 ELSE ' ' END) AS GIDERTUTAR, 
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN VATMATRAH * -1 WHEN 36 THEN VATMATRAH ELSE ' ' END) AS GELIRTUTAR, 	
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN VATMATRAH * -1 WHEN 36 THEN VATMATRAH WHEN 3 THEN (- 1 * VATMATRAH) ELSE ' ' END) AS TUTAR,
	'' AS INDIRIMSIZTUTAR,

	

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 3 THEN  (VATMATRAH/(CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 1 ELSE dbo.LG_106_20_STLINE.REPORTRATE END) ) ELSE ' ' END) AS DGIDERTUTAR, 		

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0  ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)		
					             WHEN 36 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DGELIRTUTAR, 		

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE END) 
						WHEN 36 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE END) 
						  WHEN 3 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE END))  ELSE ' ' END) AS DTUTAR,
	'' AS DINDIRIMSIZTUTAR,

	dbo.L_TRADGRP.GCODE AS PROJEKODU, 
	dbo.L_TRADGRP.GDEF AS PROJEADI, 
	LG_106_PROJECT.CODE AS PROJEKODU2, 
	LG_106_PROJECT.NAME AS PROJEADI2, 

	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	
              LG_106_SPECODES_1.SPECODE AS GRUPKODU, 	
	 LG_106_SPECODES_1.DEFINITION_ AS MASRAFGRUBU,
	 dbo.LG_106_20_STLINE.DELVRYCODE AS TASARONKODU,  
	 '' AS TASARONADI, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN AMOUNT WHEN 36 THEN AMOUNT WHEN 3 THEN (- 1 * AMOUNT) ELSE ' ' END) AS  MIKTAR,
 	
             dbo.L_CAPIDIV.NAME AS ISYERI,
	''  AS DAGITIMMASRAF, 
	''  AS DAGITIMMASRAF1,
	''  AS DAGITIMMASRAF2,	
	''  AS DDAGITIMMASRAF, 
	''  AS DDAGITIMMASRAF1,
	''  AS DDAGITIMMASRAF2, 
	dbo.LG_106_CLCARD.CODE AS CARINO,
        dbo.LG_106_CLCARD.DEFINITION_ AS CARIADI,
	CASE dbo.LG_106_20_STFICHE.BILLED WHEN 1 
	THEN 
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
	ELSE
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
 	END AS ACIKLAMA
, dbo.LG_106_20_STLINE.SPECODE AS HAREKETOZELKODU
, dbo.LG_106_20_STLINE.SPECODE2 AS HAREKETOZELKODU2
, LG_106_SPECODES_2.DEFINITION_ AS HAREKETOZELKODU2ACIKLAMA

,dbo.LG_106_20_STFICHE.DEPARTMENT
,LG_106_SPECODES.DEFINITION_ AS DEPARTMAN
 ,CASE WHEN LEN(LG_106_20_STFICHE.SHPAGNCOD) > 1 THEN LG_106_20_STFICHE.SHPAGNCOD
 ELSE LG_106_20_INVOICE.SHPAGNCOD END AS GENWEB_ONAYNO
 ,LG_106_20_STFICHE.DOCODE AS BELGENO
FROM	
	dbo.LG_106_20_STLINE (NOLOCK) LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES ON dbo.LG_106_20_STLINE.SPECODE = LG_106_SPECODES.SPECODE AND (LG_106_SPECODES.CODETYPE = 4) LEFT OUTER JOIN	
	dbo.LG_106_ITEMS (NOLOCK) ON dbo.LG_106_20_STLINE.STOCKREF = dbo.LG_106_ITEMS.LOGICALREF LEFT OUTER JOIN
	dbo.LG_106_20_STFICHE (NOLOCK) ON dbo.LG_106_20_STLINE.STFICHEREF = dbo.LG_106_20_STFICHE.LOGICALREF LEFT OUTER JOIN
	dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_STFICHE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_1 (NOLOCK) ON dbo.LG_106_ITEMS.STGRPCODE = LG_106_SPECODES_1.SPECODE
	LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_2 (NOLOCK) ON dbo.LG_106_20_STLINE.SPECODE2 = LG_106_SPECODES_2.SPECODE AND LG_106_SPECODES_2.SPECODETYPE=54 LEFT OUTER JOIN
	dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_STFICHE.TRADINGGRP = dbo.L_TRADGRP.GCODE LEFT OUTER JOIN 
	dbo.LG_106_PROJECT (NOLOCK) ON LG_106_20_STLINE.PROJECTREF = LG_106_PROJECT.LOGICALREF LEFT OUTER JOIN 
	dbo.LG_106_20_INVOICE (NOLOCK) ON dbo.LG_106_20_STFICHE.INVOICEREF = dbo.LG_106_20_INVOICE.LOGICALREF LEFT OUTER JOIN
	dbo.LG_106_CLCARD (NOLOCK) ON dbo.LG_106_20_STFICHE.CLIENTREF = dbo.LG_106_CLCARD.LOGICALREF

WHERE 	
	(dbo.LG_106_20_STFICHE.TRCODE IN (1)) AND (dbo.LG_106_ITEMS.PRODCOUNTRY LIKE 'GL%') AND (dbo.L_CAPIDIV.FIRMNR = 106) 
AND (LG_106_SPECODES_1.CODETYPE = 4)

UNION ALL


SELECT --TOP 1000    	
	'GELÝRLER' AS TUR,
    dbo.LG_106_20_STFICHE.FICHENO AS FISNO, 
	--'-' AS FISNO,
	dbo.LG_106_20_STFICHE.DATE_ AS FISTARIHI,
	DatePart(yy, dbo.LG_106_20_STFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_STFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_STFICHE.DATE_)AS GUN, 
	dbo.LG_106_ITEMS.CODE AS MASRAFKODU, 
	dbo.LG_106_ITEMS.NAME AS MASRAFADI,

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 3 THEN VATMATRAH ELSE ' ' END) AS GIDERTUTAR, 
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN VATMATRAH WHEN 36 THEN VATMATRAH ELSE ' ' END) AS GELIRTUTAR, 	
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN VATMATRAH WHEN 36 THEN VATMATRAH WHEN 3 THEN (- 1 * VATMATRAH) ELSE ' ' END) AS TUTAR,
	'' AS INDIRIMSIZTUTAR,

	

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 3 THEN  (VATMATRAH/(CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 1 ELSE dbo.LG_106_20_STLINE.REPORTRATE END) ) ELSE ' ' END) AS DGIDERTUTAR, 		

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0  ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)		
					             WHEN 36 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DGELIRTUTAR, 		

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE END) 
						WHEN 36 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE END) 
						  WHEN 3 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 ELSE VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE END))  ELSE ' ' END) AS DTUTAR,
	'' AS DINDIRIMSIZTUTAR,

	dbo.L_TRADGRP.GCODE AS PROJEKODU, 
	dbo.L_TRADGRP.GDEF AS PROJEADI, 
	LG_106_PROJECT.CODE AS PROJEKODU2, 
	LG_106_PROJECT.NAME AS PROJEADI2, 

	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	
              LG_106_SPECODES_1.SPECODE AS GRUPKODU, 	
	 LG_106_SPECODES_1.DEFINITION_ AS MASRAFGRUBU,
	 dbo.LG_106_20_STLINE.DELVRYCODE AS TASARONKODU,  
	 '' AS TASARONADI, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 8 THEN AMOUNT WHEN 36 THEN AMOUNT WHEN 3 THEN (- 1 * AMOUNT) ELSE ' ' END) AS  MIKTAR,
 	
             dbo.L_CAPIDIV.NAME AS ISYERI,
	''  AS DAGITIMMASRAF, 
	''  AS DAGITIMMASRAF1,
	''  AS DAGITIMMASRAF2,	
	''  AS DDAGITIMMASRAF, 
	''  AS DDAGITIMMASRAF1,
	''  AS DDAGITIMMASRAF2, 
	dbo.LG_106_CLCARD.CODE AS CARINO,
        dbo.LG_106_CLCARD.DEFINITION_ AS CARIADI,
	CASE dbo.LG_106_20_STFICHE.BILLED WHEN 1 
	THEN 
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
	ELSE
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
 	END AS ACIKLAMA
, dbo.LG_106_20_STLINE.SPECODE AS HAREKETOZELKODU
, dbo.LG_106_20_STLINE.SPECODE2 AS HAREKETOZELKODU2
, LG_106_SPECODES_2.DEFINITION_ AS HAREKETOZELKODU2ACIKLAMA

,dbo.LG_106_20_STFICHE.DEPARTMENT
,LG_106_SPECODES.DEFINITION_ AS DEPARTMAN
 ,CASE WHEN LEN(LG_106_20_STFICHE.SHPAGNCOD) > 1 THEN LG_106_20_STFICHE.SHPAGNCOD
 ELSE LG_106_20_INVOICE.SHPAGNCOD END AS GENWEB_ONAYNO
 ,LG_106_20_STFICHE.DOCODE AS BELGENO
FROM	
	dbo.LG_106_20_STLINE (NOLOCK) LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES ON dbo.LG_106_20_STLINE.SPECODE = LG_106_SPECODES.SPECODE AND (LG_106_SPECODES.CODETYPE = 4) LEFT OUTER JOIN	
	dbo.LG_106_ITEMS (NOLOCK) ON dbo.LG_106_20_STLINE.STOCKREF = dbo.LG_106_ITEMS.LOGICALREF LEFT OUTER JOIN
	dbo.LG_106_20_STFICHE (NOLOCK) ON dbo.LG_106_20_STLINE.STFICHEREF = dbo.LG_106_20_STFICHE.LOGICALREF LEFT OUTER JOIN
	dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_STFICHE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_1 (NOLOCK) ON dbo.LG_106_ITEMS.STGRPCODE = LG_106_SPECODES_1.SPECODE
	LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_2 (NOLOCK) ON dbo.LG_106_20_STLINE.SPECODE2 = LG_106_SPECODES_2.SPECODE AND LG_106_SPECODES_2.SPECODETYPE=54 LEFT OUTER JOIN
	dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_STFICHE.TRADINGGRP = dbo.L_TRADGRP.GCODE LEFT OUTER JOIN 
	dbo.LG_106_PROJECT (NOLOCK) ON LG_106_20_STLINE.PROJECTREF = LG_106_PROJECT.LOGICALREF LEFT OUTER JOIN 
	dbo.LG_106_20_INVOICE (NOLOCK) ON dbo.LG_106_20_STFICHE.INVOICEREF = dbo.LG_106_20_INVOICE.LOGICALREF LEFT OUTER JOIN
	dbo.LG_106_CLCARD (NOLOCK) ON dbo.LG_106_20_STFICHE.CLIENTREF = dbo.LG_106_CLCARD.LOGICALREF

WHERE 	
	(dbo.LG_106_20_STFICHE.TRCODE IN (8, 3, 36)) AND (dbo.LG_106_ITEMS.PRODCOUNTRY LIKE 'GL%') AND (dbo.L_CAPIDIV.FIRMNR = 106) 
AND (LG_106_SPECODES_1.CODETYPE = 4)
--AND L_TRADGRP.GCODE  not in ( '16.00.000.004', '06.00.010.030', '06.00.020.096', '06.03.040.067', '06.07.040.115', '09.00.010.120', '09.02.040.128', '10.00.010.001', '10.02.040.034', '16.00.010.005', '16.06.040.033', '34.00.010.013', '34.07.040.035', '16.00.020.143', '59.00.010.146')
--AND LG_106_PROJECT.CODE  not in ( '01.16.00.000.004', '01.06.00.010.030', '01.06.00.020.096', '01.06.03.040.067', '01.06.07.040.115', '01.09.00.010.120', '01.09.02.040.128', '10.10.00.010.001', '10.10.02.040.034', '10.16.00.010.005', '10.16.06.040.033', '10.34.00.010.013', '10.34.07.040.035', '10.16.00.020.143', '10.59.00.010.146')








UNION ALL


SELECT     	
	'GELÝRLER' AS TUR, 
	dbo.LG_106_20_BNFICHE.FICHENO AS FISNO,
    --'-' AS FISNO,
	dbo.LG_106_20_BNFICHE.DATE_ AS FISTARIHI,
	DatePart(yy, dbo.LG_106_20_BNFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_BNFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_BNFICHE.DATE_)AS GUN,  
             dbo.LG_106_CLCARD.CODE AS MASRAFKODU, 	
	dbo.LG_106_CLCARD.DEFINITION_ AS MASRAFADI, 

	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 4 THEN AMOUNT ELSE '' END) AS GIDERTUTAR, 
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN AMOUNT ELSE '' END) AS GELIRTUTAR, 
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN AMOUNT WHEN 4 THEN (- 1 * AMOUNT) ELSE ' ' END) AS TUTAR, '' AS INDIRIMSIZTUTAR,

	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 4 THEN REPORTNET ELSE '' END) AS DGIDERTUTAR, 
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN REPORTNET ELSE '' END) AS DGELIRTUTAR, 
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN REPORTNET WHEN 4 THEN (- 1 * REPORTNET) ELSE ' ' END) AS DTUTAR, '' AS DINDIRIMSIZTUTAR,

             dbo.L_TRADGRP.GCODE AS PROJEKODU, 	
	dbo.L_TRADGRP.GDEF AS PROJEADI,
        LG_106_PROJECT.CODE AS PROJEKODU2, 	
	LG_106_PROJECT.NAME AS PROJEADI2,

	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	
	LG_106_SPECODES_2.SPECODE AS GRUPKODU,
	LG_106_SPECODES_2.DEFINITION_ AS MASRAFGRUBU, 
             LG_106_SPECODES_1.SPECODE AS TASARONKODU, 	
	LG_106_SPECODES_1.DEFINITION_ AS TASARONADI,
	'' AS MIKTAR,
	dbo.L_CAPIDIV.NAME AS ISYERI,
	''  AS DAGITIMMASRAF, 
	''  AS DAGITIMMASRAF1,
	''  AS DAGITIMMASRAF2,
	''  AS DDAGITIMMASRAF, 
	''  AS DDAGITIMMASRAF1,
	'' AS DDAGITIMMASRAF2, 
	'' AS CARINO,
        '' AS CARIADI,
	(LG_106_20_BNFICHE.GENEXP1+' '+LG_106_20_BNFICHE.GENEXP2+' '+LG_106_20_BNFICHE.GENEXP3+' '+LG_106_20_BNFICHE.GENEXP4+' '+LG_106_20_BNFLINE.LINEEXP) AS ACIKLAMA
, dbo.LG_106_20_BNFLINE.SPECODE AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,dbo.LG_106_20_BNFLINE.DEPARTMENT  
,LG_106_SPECODES_4.DEFINITION_ AS DEPARTMAN   
,LG_106_20_BNFLINE.BNTRACKINGNO   AS GENWEB_ONAYNO  
 ,LG_106_20_BNFICHE.SPECODE  AS BELGENO               	
FROM 	
	dbo.LG_106_CLCARD (NOLOCK) INNER JOIN
             dbo.LG_106_20_BNFLINE (NOLOCK) ON dbo.LG_106_CLCARD.LOGICALREF = dbo.LG_106_20_BNFLINE.CLIENTREF INNER JOIN	
             dbo.LG_106_20_BNFICHE (NOLOCK) ON dbo.LG_106_20_BNFLINE.SOURCEFREF = dbo.LG_106_20_BNFICHE.LOGICALREF LEFT OUTER JOIN	
	dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_BNFICHE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN      
             dbo.LG_106_SPECODES LG_106_SPECODES_1 (NOLOCK) ON dbo.LG_106_20_BNFICHE.SPECODE = LG_106_SPECODES_1.SPECODE LEFT OUTER JOIN	
             dbo.LG_106_SPECODES LG_106_SPECODES_2 (NOLOCK) ON dbo.LG_106_CLCARD.SPECODE = LG_106_SPECODES_2.SPECODE
             LEFT OUTER JOIN	
             dbo.LG_106_SPECODES LG_106_SPECODES_4 (NOLOCK) ON dbo.LG_106_20_BNFLINE.SPECODE = LG_106_SPECODES_4.SPECODE AND (LG_106_SPECODES_4.CODETYPE = 4)
              LEFT OUTER JOIN	
             dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_BNFLINE.TRADINGGRP = dbo.L_TRADGRP.GCODE LEFT OUTER JOIN
	LG_106_PROJECT (NOLOCK) ON LG_106_20_BNFLINE.PROJECTREF = LG_106_PROJECT.LOGICALREF
WHERE	
	(dbo.L_CAPIDIV.FIRMNR = 106) AND (dbo.LG_106_CLCARD.SUBSCRIBEREXT LIKE 'GL%') AND 
	(LG_106_SPECODES_1.SPECODETYPE = 43 OR LG_106_SPECODES_1.SPECODETYPE IS NULL) AND (LG_106_SPECODES_2.SPECODETYPE = 26 OR LG_106_SPECODES_2.SPECODETYPE IS NULL)
--AND L_TRADGRP.GCODE  not in ( '16.00.000.004', '06.00.010.030', '06.00.020.096', '06.03.040.067', '06.07.040.115', '09.00.010.120', '09.02.040.128', '10.00.010.001', '10.02.040.034', '16.00.010.005', '16.06.040.033', '34.00.010.013', '34.07.040.035', '16.00.020.143', '59.00.010.146')
--AND LG_106_PROJECT.CODE  not in ( '01.16.00.000.004', '01.06.00.010.030', '01.06.00.020.096', '01.06.03.040.067', '01.06.07.040.115', '01.09.00.010.120', '01.09.02.040.128', '01.10.00.010.001', '01.10.02.040.034', '01.16.00.010.005', '01.16.06.040.033', '01.34.00.010.013', '01.34.07.040.035', '01.16.00.020.143', '01.59.00.010.146')

UNION ALL	

SELECT	
	'GELÝRLER' AS TUR, 
	dbo.LG_106_20_CLFICHE.FICHENO AS FISNO, 
    --'' AS  FISNO,
	dbo.LG_106_20_CLFICHE.DATE_ AS FISTARIHI,
	DatePart(yy, dbo.LG_106_20_CLFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_CLFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_CLFICHE.DATE_)AS GUN,  
	dbo.LG_106_CLCARD.CODE AS MASRAFKODU, 
	dbo.LG_106_CLCARD.DEFINITION_ AS MASRAFADI, 

	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 0 THEN dbo.LG_106_20_CLFLINE.AMOUNT ELSE '' END AS GIDERTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN (dbo.LG_106_20_CLFLINE.AMOUNT) ELSE '' END AS GELIRTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN dbo.LG_106_20_CLFLINE.AMOUNT WHEN 0 THEN (dbo.LG_106_20_CLFLINE.AMOUNT * - 1)  ELSE '' END AS TUTAR,
	'' AS INDIRIMSIZTUTAR,

	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 0 THEN dbo.LG_106_20_CLFLINE.REPORTNET ELSE '' END AS DGIDERTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN (dbo.LG_106_20_CLFLINE.REPORTNET) ELSE '' END AS DGELIRTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN dbo.LG_106_20_CLFLINE.REPORTNET WHEN 0 THEN (dbo.LG_106_20_CLFLINE.REPORTNET * - 1)  ELSE '' END AS DTUTAR,
	'' AS DINDIRIMSIZTUTAR, 


	dbo.L_TRADGRP.GCODE AS PROJEKODU, 
	dbo.L_TRADGRP.GDEF AS PROJEADI,
	LG_106_PROJECT.CODE AS PROJEKODU2, 
	LG_106_PROJECT.NAME AS PROJEADI2,

	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	dbo.LG_106_SPECODES.SPECODE AS GRUPKODU,  
             dbo.LG_106_SPECODES.DEFINITION_ AS MASRAFGRUBU, 	
             LG_106_SPECODES_1.SPECODE AS TASARONKODU, 	
	LG_106_SPECODES_1.DEFINITION_ AS TASARONADI, 
	'' AS MIKTAR,
	dbo.L_CAPIDIV.NAME AS ISYERI, 
	'' AS DAGITIMMASRAF, 
	'' AS DAGITIMMASRAF1,
	'' AS DAGITIMMASRAF2,
	'' AS DDAGITIMMASRAF, 
	'' AS DDAGITIMMASRAF1,
	'' AS DDAGITIMMASRAF2,
	''  AS CARINO,
	''  AS CARIADI, 
	(LG_106_20_CLFICHE.GENEXP1+' '+LG_106_20_CLFICHE.GENEXP2+' '+LG_106_20_CLFICHE.GENEXP3+' '+LG_106_20_CLFICHE.GENEXP4+' '+LG_106_20_CLFLINE.LINEEXP)  AS ACIKLAMA
, dbo.LG_106_20_CLFLINE.SPECODE AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,LG_106_20_CLFLINE.DEPARTMENT
	,SUBSTRING(LG_106_SPECODES_2.DEFINITION_, CHARINDEX('/', LG_106_SPECODES_2.DEFINITION_) + 1, CHARINDEX('-',LG_106_SPECODES_2.DEFINITION_) - 1 - CHARINDEX('/', LG_106_SPECODES_2.DEFINITION_)) AS DEPARTMAN 
	,'' AS GENWEB_ONAYNO
	, LG_106_20_CLFICHE.DOCODE AS BELGENO
FROM         	
	dbo.LG_106_20_CLFICHE (NOLOCK) INNER JOIN
             dbo.LG_106_20_CLFLINE (NOLOCK) ON dbo.LG_106_20_CLFICHE.LOGICALREF = dbo.LG_106_20_CLFLINE.SOURCEFREF INNER JOIN	
             dbo.LG_106_CLCARD (NOLOCK) ON dbo.LG_106_20_CLFLINE.CLIENTREF = dbo.LG_106_CLCARD.LOGICALREF LEFT OUTER JOIN	
	dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_CLFICHE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES_2 ON LG_106_SPECODES_2.SPECODE = dbo.LG_106_20_CLFLINE.SPECODE AND (LG_106_SPECODES_2.CODETYPE = 4) LEFT OUTER JOIN      
             dbo.LG_106_SPECODES LG_106_SPECODES_1 (NOLOCK) ON dbo.LG_106_20_CLFICHE.SPECCODE = LG_106_SPECODES_1.SPECODE LEFT OUTER JOIN	
             dbo.LG_106_SPECODES (NOLOCK) ON dbo.LG_106_CLCARD.SPECODE = dbo.LG_106_SPECODES.SPECODE LEFT OUTER JOIN	
             dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_CLFLINE.TRADINGGRP = dbo.L_TRADGRP.GCODE	LEFT OUTER JOIN
	LG_106_PROJECT (NOLOCK) ON LG_106_20_CLFLINE.CLPRJREF = LG_106_PROJECT.LOGICALREF
WHERE     	
	(dbo.LG_106_20_CLFLINE.TRCODE = 5)  AND 
             (LG_106_SPECODES_1.SPECODETYPE = 44 OR LG_106_SPECODES_1.SPECODETYPE IS NULL) AND (dbo.LG_106_SPECODES.SPECODETYPE = 26 OR dbo.LG_106_SPECODES.SPECODETYPE IS NULL)   AND 	
	(dbo.L_CAPIDIV.FIRMNR = 106)   AND 
	(dbo.LG_106_CLCARD.SUBSCRIBEREXT LIKE 'GL%')         
--AND L_TRADGRP.GCODE  not in ( '16.00.000.004', '06.00.010.030', '06.00.020.096', '06.03.040.067', '06.07.040.115', '09.00.010.120', '09.02.040.128', '10.00.010.001', '10.02.040.034', '16.00.010.005', '16.06.040.033', '34.00.010.013', '34.07.040.035', '16.00.020.143', '59.00.010.146')
--AND LG_106_PROJECT.CODE  not in ( '01.16.00.000.004', '01.06.00.010.030', '01.06.00.020.096', '01.06.03.040.067', '01.06.07.040.115', '01.09.00.010.120', '01.09.02.040.128', '01.10.00.010.001', '01.10.02.040.034', '01.16.00.010.005', '01.16.06.040.033', '01.34.00.010.013', '01.34.07.040.035', '01.16.00.020.143', '01.59.00.010.146')

UNION ALL	

SELECT     	
	'MASRAFLAR' AS TUR, 
	dbo.LG_106_20_BNFICHE.FICHENO AS FISNO, 
    --'-' AS FISNO,
	dbo.LG_106_20_BNFICHE.DATE_ AS FISTARIHI, 
	DatePart(yy, dbo.LG_106_20_BNFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_BNFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_BNFICHE.DATE_)AS GUN, 
	dbo.LG_106_CLCARD.CODE AS MASRAFKODU, 
	dbo.LG_106_CLCARD.DEFINITION_ AS MASRAFADI, 

	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 4 THEN AMOUNT ELSE '' END) AS GIDERTUTAR, 
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN AMOUNT ELSE '' END) AS GELIRTUTAR, 
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN AMOUNT WHEN 4 THEN (- 1 * AMOUNT) ELSE ' ' END) AS TUTAR, 
	'' AS INDIRIMSIZTUTAR,

	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 4 THEN REPORTNET ELSE '' END) AS DGIDERTUTAR, 	
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN REPORTNET ELSE '' END) AS DGELIRTUTAR, 
	(CASE dbo.LG_106_20_BNFLINE.TRCODE WHEN 3 THEN REPORTNET WHEN 4 THEN (- 1 * REPORTNET) ELSE ' ' END) AS DTUTAR, 
	'' AS DINDIRIMSIZTUTAR,

	dbo.L_TRADGRP.GCODE AS PROJEKODU, 
	dbo.L_TRADGRP.GDEF AS PROJEADI,
	LG_106_PROJECT.CODE AS PROJEKODU2, 
	LG_106_PROJECT.NAME AS PROJEADI2,

	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	LG_106_SPECODES_2.SPECODE AS GRUPKODU, 
	LG_106_SPECODES_2.DEFINITION_ AS MASRAFGRUBU, 
	LG_106_SPECODES_1.SPECODE AS TASARONKODU, 
	LG_106_SPECODES_1.DEFINITION_ AS TASARONADI,

	'' AS MIKTAR,
	 dbo.L_CAPIDIV.NAME AS ISYERI,
	'' AS DAGITIMMASRAF,
	'' AS DAGITIMMASRAF1,
	'' AS DAGITIMMASRAF2,
	'' AS DDAGITIMMASRAF, 
	'' AS DDAGITIMMASRAF1,
	'' AS DDAGITIMMASRAF2,
	''  AS CARINO,
	''  AS CARIADI,  
	(LG_106_20_BNFICHE.GENEXP1+' '+LG_106_20_BNFICHE.GENEXP2+' '+LG_106_20_BNFICHE.GENEXP3+' '+LG_106_20_BNFICHE.GENEXP4+' '+LG_106_20_BNFLINE.LINEEXP) AS ACIKLAMA
, dbo.LG_106_20_BNFLINE.SPECODE AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,LG_106_20_BNFLINE.DEPARTMENT
,SUBSTRING(LG_106_SPECODES_3.DEFINITION_, CHARINDEX('/', LG_106_SPECODES_3.DEFINITION_) + 1, CHARINDEX('-',LG_106_SPECODES_3.DEFINITION_) - 1 - CHARINDEX('/', LG_106_SPECODES_3.DEFINITION_)) AS DEPARTMAN 
,LG_106_20_BNFLINE.BNTRACKINGNO AS GENWEB_ONAYNO
, LG_106_20_BNFICHE.SPECODE AS BELGENO
FROM	
	dbo.LG_106_CLCARD (NOLOCK) INNER JOIN
	dbo.LG_106_20_BNFLINE (NOLOCK) ON dbo.LG_106_CLCARD.LOGICALREF = dbo.LG_106_20_BNFLINE.CLIENTREF INNER JOIN
	dbo.LG_106_20_BNFICHE (NOLOCK) ON dbo.LG_106_20_BNFLINE.SOURCEFREF = dbo.LG_106_20_BNFICHE.LOGICALREF LEFT OUTER JOIN
	
	dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_BNFLINE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_1 (NOLOCK) ON dbo.LG_106_20_BNFICHE.SPECODE = LG_106_SPECODES_1.SPECODE LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_2 (NOLOCK) ON dbo.LG_106_CLCARD.SPECODE = LG_106_SPECODES_2.SPECODE  LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_3 (NOLOCK) ON dbo.LG_106_20_BNFLINE.SPECODE = LG_106_SPECODES_3.SPECODE AND (LG_106_SPECODES_3.CODETYPE = 4)  LEFT OUTER JOIN
	dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_BNFLINE.TRADINGGRP = dbo.L_TRADGRP.GCODE LEFT OUTER JOIN
	LG_106_PROJECT (NOLOCK) ON LG_106_20_BNFLINE.PROJECTREF = LG_106_PROJECT.LOGICALREF
WHERE	
	(dbo.LG_106_CLCARD.SUBSCRIBEREXT LIKE 'GD%') AND 
	(dbo.L_CAPIDIV.FIRMNR = 106) AND (LG_106_SPECODES_1.SPECODETYPE = 43 OR LG_106_SPECODES_1.SPECODETYPE IS NULL)  AND
	(LG_106_SPECODES_2.SPECODETYPE = 26 OR LG_106_SPECODES_2.SPECODETYPE IS NULL)
--AND L_TRADGRP.GCODE  not in ( '16.00.000.004', '06.00.010.030', '06.00.020.096', '06.03.040.067', '06.07.040.115', '09.00.010.120', '09.02.040.128', '10.00.010.001', '10.02.040.034', '16.00.010.005', '16.06.040.033', '34.00.010.013', '34.07.040.035', '16.00.020.143', '59.00.010.146')
--AND LG_106_PROJECT.CODE  not in ( '01.16.00.000.004', '01.06.00.010.030', '01.06.00.020.096', '01.06.03.040.067', '01.06.07.040.115', '01.09.00.010.120', '01.09.02.040.128', '01.10.00.010.001', '01.10.02.040.034', '01.16.00.010.005', '01.16.06.040.033', '01.34.00.010.013', '01.34.07.040.035', '01.16.00.020.143', '01.59.00.010.146')

UNION ALL	

SELECT	
	'MASRAFLAR' AS TUR, 
	dbo.LG_106_20_CLFICHE.FICHENO AS FISNO, 
    --'-' AS FISNO,
	dbo.LG_106_20_CLFICHE.DATE_ AS FISTARIHI,
	DatePart(yy, dbo.LG_106_20_CLFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_CLFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_CLFICHE.DATE_)AS GUN,  
	dbo.LG_106_CLCARD.CODE AS MASRAFKODU, 
	dbo.LG_106_CLCARD.DEFINITION_ AS MASRAFADI,

	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 0 THEN AMOUNT ELSE '' END AS GIDERTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN 
              CASE  dbo.LG_106_20_CLFLINE.TRCODE WHEN 5 THEN AMOUNT ELSE (-1*AMOUNT) END ELSE '' END AS GELIRTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN AMOUNT WHEN 0 THEN (AMOUNT * - 1) ELSE '' END AS TUTAR, 
	'' AS INDIRIMSIZTUTAR,

	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 0 THEN REPORTNET ELSE '' END AS DGIDERTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN (-1*REPORTNET) ELSE '' END AS DGELIRTUTAR, 
	CASE dbo.LG_106_20_CLFLINE.SIGN WHEN 1 THEN REPORTNET WHEN 0 THEN (REPORTNET * - 1) ELSE '' END AS DTUTAR, 
	'' AS DINDIRIMSIZTUTAR,
	dbo.L_TRADGRP.GCODE AS PROJEKODU, 
	dbo.L_TRADGRP.GDEF AS PROJEADI, 
	LG_106_PROJECT.CODE AS PROJEKODU2, 
	LG_106_PROJECT.NAME AS PROJEADI2, 
	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	LG_106_SPECODES_2.SPECODE AS GRUPKODU, 
	LG_106_SPECODES_2.DEFINITION_ AS MASRAFGRUBU, 
	LG_106_SPECODES_2.SPECODE AS TASARONKODU, 
	LG_106_SPECODES_2.DEFINITION_ AS TASARONADI, 
	'' AS MIKTAR, 
        dbo.L_CAPIDIV.NAME AS ISYERI, 	
	'' AS DAGITIMMASRAF,
	'' AS DAGITIMMASRAF1,
	'' AS DAGITIMMASRAF2,
	'' AS DDAGITIMMASRAF, 
	'' AS DDAGITIMMASRAF1,
	'' AS DDAGITIMMASRAF2, 
	''  AS CARINO,
	''  AS CARIADI, 
	(LG_106_20_CLFICHE.GENEXP1+' '+LG_106_20_CLFICHE.GENEXP2+' '+LG_106_20_CLFICHE.GENEXP3+' '+LG_106_20_CLFICHE.GENEXP4+' '+LG_106_20_CLFLINE.LINEEXP)  AS ACIKLAMA
, dbo.LG_106_20_CLFLINE.SPECODE AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,LG_106_20_CLFLINE.DEPARTMENT
,SUBSTRING(LG_106_SPECODES_1.DEFINITION_, CHARINDEX('/', LG_106_SPECODES_1.DEFINITION_) + 1, CHARINDEX('-',LG_106_SPECODES_1.DEFINITION_) - 1 - CHARINDEX('/', LG_106_SPECODES_1.DEFINITION_)) AS DEPARTMAN 
,'' AS GENWEB_ONAYNO
, LG_106_20_CLFICHE.DOCODE AS BELGENO
FROM         	
	dbo.LG_106_CLCARD (NOLOCK) RIGHT OUTER JOIN
	dbo.LG_106_20_CLFLINE (NOLOCK) ON dbo.LG_106_CLCARD.LOGICALREF = dbo.LG_106_20_CLFLINE.CLIENTREF LEFT OUTER JOIN
	dbo.LG_106_20_CLFICHE (NOLOCK) ON dbo.LG_106_20_CLFLINE.SOURCEFREF = dbo.LG_106_20_CLFICHE.LOGICALREF LEFT OUTER JOIN
	dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_CLFICHE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_2 (NOLOCK) ON dbo.LG_106_CLCARD.SPECODE = LG_106_SPECODES_2.SPECODE   LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_1 (NOLOCK) ON  LG_106_SPECODES_1.SPECODE = dbo.LG_106_20_CLFLINE.SPECODE AND (LG_106_SPECODES_1.CODETYPE = 4) LEFT OUTER JOIN
	dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_CLFLINE.TRADINGGRP = dbo.L_TRADGRP.GCODE LEFT OUTER JOIN
	LG_106_PROJECT ON LG_106_20_CLFLINE.CLPRJREF = LG_106_PROJECT.LOGICALREF

WHERE     	
	(dbo.LG_106_20_CLFLINE.TRCODE = 5) AND (dbo.LG_106_CLCARD.SUBSCRIBEREXT LIKE 'GD%') AND 
	(dbo.L_CAPIDIV.FIRMNR = 106) AND                      
	(LG_106_SPECODES_2.SPECODETYPE = 26 OR LG_106_SPECODES_2.SPECODETYPE IS NULL)
--AND L_TRADGRP.GCODE  not in ( '16.00.000.004', '06.00.010.030', '06.00.020.096', '06.03.040.067', '06.07.040.115', '09.00.010.120', '09.02.040.128', '10.00.010.001', '10.02.040.034', '16.00.010.005', '16.06.040.033', '34.00.010.013', '34.07.040.035', '16.00.020.143', '59.00.010.146')
--AND LG_106_PROJECT.CODE  not in ( '01.16.00.000.004', '01.06.00.010.030', '01.06.00.020.096', '01.06.03.040.067', '01.06.07.040.115', '01.09.00.010.120', '01.09.02.040.128', '01.10.00.010.001', '01.10.02.040.034', '01.16.00.010.005', '01.16.06.040.033', '01.34.00.010.013', '01.34.07.040.035', '01.16.00.020.143', '01.59.00.010.146')
AND dbo.LG_106_CLCARD.CODE NOT LIKE '9%'

UNION ALL	

SELECT     	
	'MASRAFLAR' AS TUR,
	LG_106_20_STFICHE.FICHENO AS FISNO, 
    --'-' AS FISNO,
--LG_106_20_STLINE.TRCODE,
	dbo.LG_106_20_STFICHE.DATE_ AS FISTARIHI,
	DatePart(yy, dbo.LG_106_20_STFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_STFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_STFICHE.DATE_)AS GUN,  
	dbo.LG_106_ITEMS.CODE AS MASRAFKODU,                       
	dbo.LG_106_ITEMS.NAME AS MASRAFADI, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN VATMATRAH WHEN 30 THEN VATMATRAH  WHEN 31 THEN VATMATRAH ELSE ' ' END) AS GIDERTUTAR, 
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 6 THEN ( VATMATRAH) WHEN 8 THEN ( VATMATRAH )ELSE ' ' END) AS GELIRTUTAR,                    
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * VATMATRAH) WHEN 30 THEN (- 1 * VATMATRAH) WHEN 31 THEN (-1* VATMATRAH)  WHEN 6 THEN  VATMATRAH WHEN 8 THEN  VATMATRAH ELSE ' ' END) AS TUTAR, 
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * LINENET) WHEN 30 THEN (- 1 * LINENET) WHEN 6 THEN  LINENET ELSE ' ' END) AS INDIRIMSIZTUTAR, 

	(CASE dbo.LG_106_20_STLINE.TRCODE 
	WHEN 1 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) WHEN 30 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)  WHEN 31 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DGIDERTUTAR, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 6 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)) ELSE ' ' END) AS DGELIRTUTAR,    
                
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 30 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 31 THEN (-1* (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END))  WHEN 6 THEN  (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DTUTAR, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (LINENET/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 30 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (LINENET/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 6 THEN  (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (LINENET/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DINDIRIMSIZTUTAR, 

	dbo.L_TRADGRP.GCODE AS PROJEKODU, 	
	dbo.L_TRADGRP.GDEF AS PROJEADI, 

	LG_106_PROJECT.CODE AS PROJEKODU2,
	LG_106_PROJECT.NAME AS PROJEADI2,

	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	LG_106_SPECODES_1.SPECODE AS GRUPKODU, 
	LG_106_SPECODES_1.DEFINITION_ AS MASRAFGRUBU, 
	dbo.LG_106_20_STLINE.DELVRYCODE AS TASARONKODU, 
	LG_106_SPECODES_2.DEFINITION_ AS TASARONADI ,

--	'' AS MIKTAR,
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN AMOUNT WHEN 30 THEN AMOUNT WHEN 31 THEN AMOUNT WHEN 6 THEN (- 1 * AMOUNT) ELSE ' ' END) AS  MIKTAR,

	dbo.L_CAPIDIV.NAME AS ISYERI,
	'' AS DAGITIMMASRAF, 
	'' AS DAGITIMMASRAF1,
	'' AS DAGITIMMASRAF2,

	'' AS DDAGITIMMASRAF, 
	'' AS DDAGITIMMASRAF1,
	'' AS DDAGITIMMASRAF2,	
	dbo.LG_106_CLCARD.CODE AS CARINO,
        dbo.LG_106_CLCARD.DEFINITION_ AS CARIADI,
	CASE dbo.LG_106_20_STFICHE.BILLED WHEN 1 
	THEN 
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
	ELSE
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
 	END AS ACIKLAMA
, dbo.LG_106_20_STLINE.SPECODE AS HAREKETOZELKODU
, dbo.LG_106_20_STLINE.SPECODE2 AS HAREKETOZELKODU2
 ,LG_106_SPECODES_5.DEFINITION_ AS HAREKETOZELKODU2ACIKLAMA
 ,LG_106_20_STFICHE.DEPARTMENT
 , LG_106_SPECODES_4.DEFINITION_ AS DEPARTMAN
 ,CASE WHEN LEN(LG_106_20_STFICHE.SHPAGNCOD) > 1 THEN LG_106_20_STFICHE.SHPAGNCOD
 ELSE LG_106_20_INVOICE.SHPAGNCOD END AS GENWEB_ONAYNO
 , LG_106_20_STFICHE.DOCODE AS BELGENO
 
FROM	dbo.LG_106_20_STLINE (NOLOCK) INNER JOIN
        dbo.LG_106_ITEMS (NOLOCK) ON dbo.LG_106_20_STLINE.STOCKREF = dbo.LG_106_ITEMS.LOGICALREF LEFT OUTER JOIN
        dbo.LG_106_20_STFICHE (NOLOCK) ON dbo.LG_106_20_STLINE.STFICHEREF = dbo.LG_106_20_STFICHE.LOGICALREF LEFT OUTER JOIN
        dbo.LG_106_CLCARD (NOLOCK) ON dbo.LG_106_20_STFICHE.CLIENTREF = dbo.LG_106_CLCARD.LOGICALREF LEFT OUTER JOIN
        dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_STFICHE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES_1 (NOLOCK) ON dbo.LG_106_ITEMS.STGRPCODE = LG_106_SPECODES_1.SPECODE   LEFT OUTER JOIN
        dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_STFICHE.TRADINGGRP = dbo.L_TRADGRP.GCODE LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES_2 (NOLOCK) ON dbo.LG_106_20_STLINE.DELVRYCODE = LG_106_SPECODES_2.SPECODE LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_5 (NOLOCK) ON dbo.LG_106_20_STLINE.SPECODE2 = LG_106_SPECODES_5.SPECODE AND LG_106_SPECODES_5.SPECODETYPE=54  LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES_4 (NOLOCK) ON  dbo.LG_106_20_STLINE.SPECODE = LG_106_SPECODES_4.SPECODE AND (LG_106_SPECODES_4.CODETYPE = 4)  LEFT OUTER JOIN 
	dbo.LG_106_PROJECT on LG_106_20_STLINE.PROJECTREF = dbo.LG_106_PROJECT.LOGICALREF LEFT OUTER JOIN
	dbo.LG_106_20_INVOICE (NOLOCK) ON dbo.LG_106_20_STFICHE.INVOICEREF = dbo.LG_106_20_INVOICE.LOGICALREF 
WHERE	(dbo.LG_106_20_STFICHE.TRCODE IN (1, 6, 8,30, 31)) AND (dbo.LG_106_ITEMS.PRODCOUNTRY LIKE 'GD%') AND 
        (LG_106_SPECODES_2.SPECODETYPE IS NULL 
	OR LG_106_SPECODES_2.SPECODETYPE = 0) AND (dbo.L_CAPIDIV.FIRMNR = 106) AND (LG_106_SPECODES_1.CODETYPE = 4)
  	AND ((/*(dbo.LG_106_ITEMS.CODE NOT LIKE 'A740%' OR  dbo.LG_106_CLCARD.CODE != '320.29.1.0.00429')
  	AND */ (/*dbo.LG_106_ITEMS.CODE NOT LIKE 'A740%' OR */ dbo.LG_106_CLCARD.CODE != '120.29.2.0.00002')
  	AND  (/*dbo.LG_106_ITEMS.CODE NOT LIKE 'A740%' OR */ dbo.LG_106_CLCARD.CODE != '320.33.1.0.00126')
  	AND  (/*dbo.LG_106_ITEMS.CODE NOT LIKE 'A740%' OR */ dbo.LG_106_CLCARD.CODE != '320.38.1.0.00550')
		or dbo.LG_106_CLCARD.CODE IS NULL))
--AND L_TRADGRP.GCODE  not in ( '16.00.000.004', '06.00.010.030', '06.00.020.096', '06.03.040.067', '06.07.040.115', '09.00.010.120', '09.02.040.128', '10.00.010.001', '10.02.040.034', '16.00.010.005', '16.06.040.033', '34.00.010.013', '34.07.040.035', '16.00.020.143', '59.00.010.146')
--AND LG_106_PROJECT.CODE  not in ( '01.16.00.000.004', '01.06.00.010.030', '01.06.00.020.096', '01.06.03.040.067', '01.06.07.040.115', '01.09.00.010.120', '01.09.02.040.128', '01.10.00.010.001', '01.10.02.040.034', '01.16.00.010.005', '01.16.06.040.033', '01.34.00.010.013', '01.34.07.040.035', '01.16.00.020.143', '01.59.00.010.146')
--AND LG_106_20_STFICHE.FICHENO = '09000003'
UNION ALL
--MOTORÝNLER BURADA
SELECT     	
	'MASRAFLAR' AS TUR,
	LG_106_20_STFICHE.FICHENO AS FISNO, 
    --'-' AS FISNO,
	dbo.LG_106_20_STFICHE.DATE_ AS FISTARIHI,
	DatePart(yy, dbo.LG_106_20_STFICHE.DATE_)AS YIL,
	DatePart(m, dbo.LG_106_20_STFICHE.DATE_)AS AY,
	DatePart(dd, dbo.LG_106_20_STFICHE.DATE_)AS GUN,  
	dbo.LG_106_ITEMS.CODE AS MASRAFKODU,                       
	dbo.LG_106_ITEMS.NAME AS MASRAFADI, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN VATMATRAH WHEN 12 THEN VATMATRAH WHEN 30 THEN VATMATRAH  WHEN 31 THEN VATMATRAH ELSE ' ' END) AS GIDERTUTAR, 
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 6 THEN (- 1 * VATMATRAH) WHEN 8 THEN (- 1 * VATMATRAH )ELSE ' ' END) AS GELIRTUTAR,                    
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * VATMATRAH) WHEN 12 THEN (- 1 * VATMATRAH) WHEN 30 THEN (- 1 * VATMATRAH) WHEN 31 THEN (-1* VATMATRAH)  WHEN 6 THEN  VATMATRAH WHEN 8 THEN  VATMATRAH ELSE ' ' END) AS TUTAR, 
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * LINENET) WHEN 12 THEN (- 1 * LINENET) WHEN 30 THEN (- 1 * LINENET) WHEN 6 THEN  LINENET ELSE ' ' END) AS INDIRIMSIZTUTAR, 

	(CASE dbo.LG_106_20_STLINE.TRCODE 
	WHEN 1 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) WHEN 30 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)  WHEN 31 THEN (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DGIDERTUTAR, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 6 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)) ELSE ' ' END) AS DGELIRTUTAR,    
                
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 30 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 31 THEN (-1* (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END))  WHEN 6 THEN  (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (VATMATRAH/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DTUTAR, 

	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (LINENET/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 30 THEN (- 1 * (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (LINENET/dbo.LG_106_20_STLINE.REPORTRATE) END)) WHEN 6 THEN  (CASE dbo.LG_106_20_STLINE.REPORTRATE WHEN 0 THEN 0 
	ELSE (LINENET/dbo.LG_106_20_STLINE.REPORTRATE) END) ELSE ' ' END) AS DINDIRIMSIZTUTAR, 

	dbo.L_TRADGRP.GCODE AS PROJEKODU, 	
	dbo.L_TRADGRP.GDEF AS PROJEADI, 
	LG_106_PROJECT.CODE AS PROJEKODU2, 	
	LG_106_PROJECT.NAME AS PROJEADI2, 

	--SUBSTRING (LG_106_PROJECT.NAME,1, CHARINDEX('/', LG_106_PROJECT.NAME) - 1)  AS SEHIR, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('/', LG_106_PROJECT.NAME) + 1, CHARINDEX('-',LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', LG_106_PROJECT.NAME)) AS BELEDIYE, 
	--SUBSTRING(LG_106_PROJECT.NAME, CHARINDEX('-', LG_106_PROJECT.NAME) + 1, 20) AS PROJE, 
case when charIndex('/',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	   SUBSTRING(dbo.LG_106_PROJECT.NAME, 1, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) - 1) 
	end AS SEHIR, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
	SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('/', dbo.LG_106_PROJECT.NAME) + 1, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) - 1 - CHARINDEX('/', dbo.LG_106_PROJECT.NAME)) 
	end AS BELEDIYE, 
	case when charIndex('-',dbo.LG_106_PROJECT.NAME) = 0 then
	     dbo.LG_106_PROJECT.NAME
	   else 
		SUBSTRING(dbo.LG_106_PROJECT.NAME, CHARINDEX('-', dbo.LG_106_PROJECT.NAME) + 1, 20) 
	end AS PROJE,
	LG_106_SPECODES_1.SPECODE AS GRUPKODU, 
	LG_106_SPECODES_1.DEFINITION_ AS MASRAFGRUBU, 
	dbo.LG_106_20_STLINE.DELVRYCODE AS TASARONKODU, 
	LG_106_SPECODES_2.DEFINITION_ AS TASARONADI ,

--	'' AS MIKTAR,
	(CASE dbo.LG_106_20_STLINE.TRCODE WHEN 1 THEN AMOUNT WHEN 12 THEN AMOUNT WHEN 31 THEN AMOUNT WHEN 6 THEN (- 1 * AMOUNT) ELSE ' ' END) AS  MIKTAR,

	dbo.L_CAPIDIV.NAME AS ISYERI,
	'' AS DAGITIMMASRAF, 
	'' AS DAGITIMMASRAF1,
	'' AS DAGITIMMASRAF2,
	'' AS DDAGITIMMASRAF, 
	'' AS DDAGITIMMASRAF1,
	'' AS DDAGITIMMASRAF2,
	dbo.LG_106_CLCARD.CODE AS CARINO,
        dbo.LG_106_CLCARD.DEFINITION_ AS CARIADI,
	CASE dbo.LG_106_20_STFICHE.BILLED WHEN 1 
	THEN 
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
	ELSE
		(LG_106_20_STFICHE.GENEXP1+' '+LG_106_20_STFICHE.GENEXP2+' '+LG_106_20_STFICHE.GENEXP3+' '+LG_106_20_STFICHE.GENEXP4+' '+LG_106_20_STLINE.LINEEXP)
 	END AS ACIKLAMA
, dbo.LG_106_20_STLINE.SPECODE AS HAREKETOZELKODU 
, dbo.LG_106_20_STLINE.SPECODE2 AS HAREKETOZELKODU2
, LG_106_SPECODES_5.DEFINITION_ AS HAREKETOZELKODU2ACIKLAMA
,LG_106_20_STFICHE.DEPARTMENT
,LG_106_SPECODES_4.DEFINITION_ AS DEPARTMAN
,CASE WHEN LEN(LG_106_20_STFICHE.SHPAGNCOD) > 1 THEN LG_106_20_STFICHE.SHPAGNCOD
 ELSE LG_106_20_INVOICE.SHPAGNCOD END AS GENWEB_ONAYNO 
 , LG_106_20_STFICHE.DOCODE AS BELGENO
FROM	dbo.LG_106_20_STLINE (NOLOCK) INNER JOIN
        dbo.LG_106_ITEMS (NOLOCK) ON dbo.LG_106_20_STLINE.STOCKREF = dbo.LG_106_ITEMS.LOGICALREF LEFT OUTER JOIN
        dbo.LG_106_20_STFICHE (NOLOCK) ON dbo.LG_106_20_STLINE.STFICHEREF = dbo.LG_106_20_STFICHE.LOGICALREF LEFT OUTER JOIN
        dbo.LG_106_CLCARD (NOLOCK) ON dbo.LG_106_20_STFICHE.CLIENTREF = dbo.LG_106_CLCARD.LOGICALREF LEFT OUTER JOIN
        dbo.L_CAPIDIV (NOLOCK) ON dbo.LG_106_20_STFICHE.BRANCH = dbo.L_CAPIDIV.NR LEFT OUTER JOIN
        (select DISTINCT dbo.LG_106_SPECODES.SPECODE,dbo.LG_106_SPECODES.DEFINITION_,CODETYPE FROM dbo.LG_106_SPECODES  (NOLOCK)) LG_106_SPECODES_1  ON dbo.LG_106_ITEMS.STGRPCODE = LG_106_SPECODES_1.SPECODE  AND LG_106_SPECODES_1.CODETYPE = 4 LEFT OUTER JOIN
        dbo.L_TRADGRP (NOLOCK) ON dbo.LG_106_20_STFICHE.TRADINGGRP = dbo.L_TRADGRP.GCODE LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES_2 (NOLOCK) ON dbo.LG_106_20_STLINE.DELVRYCODE = LG_106_SPECODES_2.SPECODE LEFT OUTER JOIN
	dbo.LG_106_SPECODES LG_106_SPECODES_5 (NOLOCK) ON dbo.LG_106_20_STLINE.SPECODE2 = LG_106_SPECODES_5.SPECODE AND LG_106_SPECODES_5.SPECODETYPE=54 LEFT OUTER JOIN
        dbo.LG_106_SPECODES LG_106_SPECODES_4 (NOLOCK) ON dbo.LG_106_20_STLINE.SPECODE = LG_106_SPECODES_4.SPECODE AND (LG_106_SPECODES_4.CODETYPE = 4) LEFT OUTER JOIN 
	LG_106_PROJECT (NOLOCK) ON LG_106_20_STLINE.PROJECTREF = LG_106_PROJECT.LOGICALREF LEFT OUTER JOIN
	dbo.LG_106_20_INVOICE (NOLOCK) ON dbo.LG_106_20_STFICHE.INVOICEREF = dbo.LG_106_20_INVOICE.LOGICALREF 
WHERE	(dbo.LG_106_20_STFICHE.TRCODE IN (12)) AND 
	(LG_106_SPECODES_2.SPECODETYPE IS NULL OR LG_106_SPECODES_2.SPECODETYPE = 0) 
	AND (dbo.L_CAPIDIV.FIRMNR = 106) 
--AND (LG_106_SPECODES_1.CODETYPE = 4)
--  	AND ((dbo.LG_106_ITEMS.CODE NOT LIKE 'A740%' OR  dbo.LG_106_CLCARD.CODE != '320.29.1.0.00429')
--  	AND  (dbo.LG_106_ITEMS.CODE NOT LIKE 'A740%' OR  dbo.LG_106_CLCARD.CODE != '120.29.2.0.00002'))
--	AND L_TRADGRP.GCODE  not in ( '16.00.000.004', '06.00.010.030', '06.00.020.096', '06.03.040.067', '06.07.040.115', '09.00.010.120', '09.02.040.128', '10.00.010.001', '10.02.040.034', '16.00.010.005', '16.06.040.033', '34.00.010.013', '34.07.040.035', '16.00.020.143', '59.00.010.146')
--	AND LG_106_PROJECT.CODE  not in ( '01.16.00.000.004', '01.06.00.010.030', '01.06.00.020.096', '01.06.03.040.067', '01.06.07.040.115', '01.09.00.010.120', '01.09.02.040.128', '01.10.00.010.001', '01.10.02.040.034', '01.16.00.010.005', '01.16.06.040.033', '01.34.00.010.013', '01.34.07.040.035', '01.16.00.020.143', '01.59.00.010.146')

UNION ALL	

SELECT 	
	'MASRAFLAR' AS TUR, 
	'-' AS FISNO, 
	Tarih AS FISTARIHI,
	DatePart(yy, Tarih)AS YIL,
	DatePart(m, Tarih)AS AY,
	DatePart(dd, Tarih)AS GUN, 
	MASRAFADI AS MASRAFKODU, 
	MASRAFADI  AS MASRAFADI,
	MASRAF AS GIDERTUTAR, 
	'' AS GELIRTUTAR, 
	(MASRAF * (-1))  AS TUTAR,
	'' AS INDIRIMSIZTUTAR,
	DMASRAF AS DGIDERTUTAR, 
	'' AS DGELIRTUTAR, 
	(DMASRAF * (-1)) AS DTUTAR,
	'' AS DINDIRIMSIZTUTAR,

	'' AS PROJEKODU, 
	'' AS PROJEADI,
	PROJEKODU AS PROJEKODU2, 
	PROJEADI AS PROJEADI2,

	SUBSTRING (F.PROJEADI ,1, CHARINDEX('/', F.PROJEADI ) - 1)  AS SEHIR, 
	SUBSTRING(F.PROJEADI , CHARINDEX('/', F.PROJEADI ) + 1, CHARINDEX('-',F.PROJEADI ) - 1 - CHARINDEX('/', F.PROJEADI )) AS BELEDIYE, 
	SUBSTRING(F.PROJEADI , CHARINDEX('-', F.PROJEADI ) + 1, 20) AS PROJE,

	'' AS GRUPKODU, 
	'' AS MASRAFGRUBU, 
	'' AS TASARONKODU, 
	ISYERIADI  AS TASARONADI,
	'' AS COPMIKTARI,  
	ISYERIADI AS ISYERI, 
	'0'  AS DAGITIMMASRAF, 
	--MASRAF1  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF2 ,
	'0'  AS DDAGITIMMASRAF, 
	'0'  AS DDAGITIMMASRAF1,
	'0' AS DDAGITIMMASRAF2,
	'' AS CARINO,
	'' AS CARIADI,
	'' AS ACIKLAMA
, '' AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,'' AS DEPARTMENT
,'' AS DEPARTMAN
--from fnc_Dagitim_106()	
,'' AS GENWEB_ONAYNO
, '' AS BELGENO
from fnc_Dagitim_Hakedisegore_106_20_CRYSTAL() AS F 


UNION ALL	

SELECT 	DISTINCT
	'MASRAFLAR' AS TUR, 
	'-' AS FISNO, 
--	TARIH AS FISTARIHI,
	--DATEADD(MONTH,DA.AY-1, TARIH) AS FISTARIHI, 
	CAST(TARIH AS DATETIME) AS FISTARIHI,--DATEADD(MONTH,DA.AY-1, TARIH) AS FISTARIHI,
	DatePart(yy, TARIH) AS YIL,
--	DatePart(m, TARIH) AS AY,
	AY,
	DatePart(dd, TARIH) AS GUN, 
	MASRAFADI AS MASRAFKODU, 
	MASRAFADI  AS MASRAFADI,
	MASRAF AS GIDERTUTAR, 
	'' AS GELIRTUTAR, 
	(MASRAF * (-1)) AS TUTAR,
	'' AS INDIRIMSIZTUTAR,
	DMASRAF AS DGIDERTUTAR, 
	'' AS DGELIRTUTAR, 
	(DMASRAF * (-1)) AS DTUTAR,
	'' AS DINDIRIMSIZTUTAR,


	'' AS PROJEKODU, 
	'' AS PROJEADI,
	PROJEKODU AS PROJEKODU2, 
	PROJEADI AS PROJEADI2,

	SUBSTRING (DA.PROJEADI ,1, CHARINDEX('/', DA.PROJEADI ) - 1)  AS SEHIR, 
	SUBSTRING(DA.PROJEADI , CHARINDEX('/', DA.PROJEADI ) + 1, CHARINDEX('-',DA.PROJEADI ) - 1 - CHARINDEX('/', DA.PROJEADI )) AS BELEDIYE, 
	SUBSTRING(DA.PROJEADI , CHARINDEX('-', DA.PROJEADI ) + 1, 20) AS PROJE,

	'' AS GRUPKODU, 
	'' AS MASRAFGRUBU, 
	'' AS TASARONKODU, 
	ISYERIADI  AS TASARONADI,
	'' AS COPMIKTARI,  
	ISYERIADI AS ISYERI, 
	--MASRAF  AS DAGITIMMASRAF, 
	'0'  AS DAGITIMMASRAF, 
	--FARKCS  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF2 ,
	'0'  AS DDAGITIMMASRAF, 
	'0'  AS DDAGITIMMASRAF1,
	'0'  AS DDAGITIMMASRAF2, 
	'' AS CARINO,
	'' AS CARIADI,
	'' AS ACIKLAMA
, '' AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,'' AS DEPARTMENT
,'' AS DEPARTMAN
,'' AS GENWEB_ONAYNO
, '' AS BELGENO
from fnc_Dagitim_Atolye_106_20_CRYSTAL() DA   
UNION ALL	

SELECT 	
	'MASRAFLAR' AS TUR, 
	'-' AS FISNO, 
	Tarih AS FISTARIHI,
	DatePart(yy, Tarih)AS YIL,
	DatePart(m, Tarih)AS AY,
	DatePart(dd, Tarih)AS GUN, 
	MASRAFADI AS MASRAFKODU, 
	MASRAFADI  AS MASRAFADI,
	MASRAF AS GIDERTUTAR, 
	'' AS GELIRTUTAR, 
	(MASRAF * (-1))  AS TUTAR,
	'' AS INDIRIMSIZTUTAR,
	DMASRAF AS DGIDERTUTAR, 
	'' AS DGELIRTUTAR, 
	(DMASRAF * (-1)) AS DTUTAR,
	'' AS DINDIRIMSIZTUTAR,

	'' AS PROJEKODU, 
	'' AS PROJEADI,
	PROJEKODU AS PROJEKODU2, 
	PROJEADI AS PROJEADI2,

	SUBSTRING (F.PROJEADI ,1, CHARINDEX('/', F.PROJEADI ) - 1)  AS SEHIR, 
	SUBSTRING(F.PROJEADI , CHARINDEX('/', F.PROJEADI ) + 1, CHARINDEX('-',F.PROJEADI ) - 1 - CHARINDEX('/', F.PROJEADI )) AS BELEDIYE, 
	SUBSTRING(F.PROJEADI , CHARINDEX('-', F.PROJEADI ) + 1, 20) AS PROJE,

	'' AS GRUPKODU, 
	'' AS MASRAFGRUBU, 
	'' AS TASARONKODU, 
	ISYERIADI  AS TASARONADI,
	'' AS COPMIKTARI,  
	ISYERIADI AS ISYERI, 
	'0'  AS DAGITIMMASRAF, 
	--MASRAF1  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF2 ,
	'0'  AS DDAGITIMMASRAF, 
	'0'  AS DDAGITIMMASRAF1,
	'0' AS DDAGITIMMASRAF2,
	'' AS CARINO,
	'' AS CARIADI,
	'' AS ACIKLAMA
, '' AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,'' AS DEPARTMENT
,'' AS DEPARTMAN
,'' AS GENWEB_ONAYNO
, '' AS BELGENO
--from fnc_Dagitim_106()	

from fnc_Dagitim_Bolge_Hakedisegore_106_20_CRYSTAL() AS F 
UNION ALL
SELECT 	
	'MASRAFLAR' AS TUR, 
	'-' AS FISNO, 
--	TARIH AS FISTARIHI,
--	DATEADD(MONTH,DAD.AY-1, TARIH) AS FISTARIHI,
    CAST(TARIH AS DATETIME) AS FISTARIHI,
	DatePart(yy, TARIH) AS YIL,
--	DatePart(m, TARIH) AS AY,
	AY,
	DatePart(dd, TARIH) AS GUN, 
	MASRAFADI AS MASRAFKODU, 
	MASRAFADI  AS MASRAFADI,
	MASRAF AS GIDERTUTAR, 
	'' AS GELIRTUTAR, 
	(MASRAF * (-1)) AS TUTAR,
	'' AS INDIRIMSIZTUTAR,
	DMASRAF AS DGIDERTUTAR, 
	'' AS DGELIRTUTAR, 
	(DMASRAF * (-1)) AS DTUTAR,
	'' AS DINDIRIMSIZTUTAR,

	'' AS PROJEKODU, 
	'' AS PROJEADI,
	PROJEKODU AS PROJEKODU2, 
	PROJEADI AS PROJEADI2,

	SUBSTRING (DAD.PROJEADI ,1, CHARINDEX('/', DAD.PROJEADI ) - 1)  AS SEHIR, 
	SUBSTRING(DAD.PROJEADI , CHARINDEX('/', DAD.PROJEADI ) + 1, CHARINDEX('-',DAD.PROJEADI ) - 1 - CHARINDEX('/', DAD.PROJEADI )) AS BELEDIYE, 
	SUBSTRING(DAD.PROJEADI , CHARINDEX('-', DAD.PROJEADI ) + 1, 20) AS PROJE,

	'' AS GRUPKODU, 
	'' AS MASRAFGRUBU, 
	'' AS TASARONKODU, 
	ISYERIADI  AS TASARONADI,
	'' AS COPMIKTARI,  
	ISYERIADI AS ISYERI, 
	--MASRAF  AS DAGITIMMASRAF, 
	'0'  AS DAGITIMMASRAF, 
	--FARKCS  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF1,
	'0'  AS DAGITIMMASRAF2 ,
	'0'  AS DDAGITIMMASRAF, 
	'0'  AS DDAGITIMMASRAF1,
	'0'  AS DDAGITIMMASRAF2, 
	'' AS CARINO,
	'' AS CARIADI,
	'' AS ACIKLAMA
, '' AS HAREKETOZELKODU
, '' AS HAREKETOZELKODU2
, '' AS HAREKETOZELKODU2ACIKLAMA
,'' AS DEPARTMENT
,'' AS DEPARTMAN
,'' AS GENWEB_ONAYNO
, '' AS BELGENO
from fnc_Dagitim_Isletme_106_20_CRYSTAL() DAD





















GO


